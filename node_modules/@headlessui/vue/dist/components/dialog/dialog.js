import{computed as f,defineComponent as h,h as y,inject as B,nextTick as J,onMounted as j,onUnmounted as Q,provide as X,ref as D,watchEffect as A}from"vue";import{render as O,Features as L}from"../../utils/render.js";import{Keys as Z}from"../../keyboard.js";import{useId as b}from"../../hooks/use-id.js";import{useFocusTrap as ee,Features as w}from"../../hooks/use-focus-trap.js";import{useInertOthers as te}from"../../hooks/use-inert-others.js";import{Portal as H,PortalGroup as le}from"../portal/portal.js";import{StackMessage as W,useStackProvider as oe}from"../../internal/stack-context.js";import{match as E}from"../../utils/match.js";import{ForcePortalRoot as F}from"../../internal/portal-force-root.js";import{Description as ne,useDescriptions as ae}from"../description/description.js";import{dom as re}from"../../utils/dom.js";import{useOpenClosed as ie,State as K}from"../../internal/open-closed.js";import{useOutsideClick as ue,Features as se}from"../../hooks/use-outside-click.js";import{getOwnerDocument as pe}from"../../utils/owner.js";import{useEventListener as de}from"../../hooks/use-event-listener.js";var fe=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(fe||{});let x=Symbol("DialogContext");function P(o){let i=B(x,null);if(i===null){let e=new Error(`<${o} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,P),e}return i}let T="DC8F892D-2EBD-447C-A4C8-A03058436FF4",Me=h({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:T},initialFocus:{type:Object,default:null}},emits:{close:o=>!0},setup(o,{emit:i,attrs:e,slots:u,expose:r}){var M;let p=D(0),a=ie(),g=f(()=>o.open===T&&a!==null?E(a.value,{[K.Open]:!0,[K.Closed]:!1}):o.open),S=D(new Set),d=D(null),k=f(()=>pe(d));if(r({el:d,$el:d}),!(o.open!==T||a!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof g.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${g.value===T?void 0:o.open}`);let c=f(()=>g.value?0:1),I=f(()=>c.value===0),R=f(()=>p.value>1),_=B(x,null)!==null,N=f(()=>R.value?"parent":"leaf"),U=ee(d,f(()=>I.value?E(N.value,{parent:w.RestoreFocus,leaf:w.All&~w.FocusLock}):w.None),f(()=>({initialFocus:D(o.initialFocus),containers:S})));te(d,f(()=>R.value?I.value:!1)),oe({type:"Dialog",element:d,onUpdate:(t,l,n)=>{if(l==="Dialog")return E(t,{[W.Add](){S.value.add(n),p.value+=1},[W.Remove](){S.value.delete(n),p.value-=1}})}});let V=ae({name:"DialogDescription",slot:f(()=>({open:g.value}))}),Y=`headlessui-dialog-${b()}`,C=D(null),v={titleId:C,panelRef:D(null),dialogState:c,setTitleId(t){C.value!==t&&(C.value=t)},close(){i("close",!1)}};X(x,v),ue(()=>{var l,n,m;return[...Array.from((n=(l=k.value)==null?void 0:l.querySelectorAll("body > *"))!=null?n:[]).filter(s=>!(!(s instanceof HTMLElement)||s.contains(U.value)||v.panelRef.value&&s.contains(v.panelRef.value))),(m=v.panelRef.value)!=null?m:d.value]},(t,l)=>{c.value===0&&(R.value||(v.close(),J(()=>l==null?void 0:l.focus())))},se.IgnoreScrollbars),de((M=k.value)==null?void 0:M.defaultView,"keydown",t=>{t.key===Z.Escape&&c.value===0&&(R.value||(t.preventDefault(),t.stopPropagation(),v.close()))}),A(t=>{var $;if(c.value!==0||_)return;let l=k.value;if(!l)return;let n=l==null?void 0:l.documentElement,m=($=l.defaultView)!=null?$:window,s=n.style.overflow,G=n.style.paddingRight,z=m.innerWidth-n.clientWidth;n.style.overflow="hidden",n.style.paddingRight=`${z}px`,t(()=>{n.style.overflow=s,n.style.paddingRight=G})}),A(t=>{if(c.value!==0)return;let l=re(d);if(!l)return;let n=new IntersectionObserver(m=>{for(let s of m)s.boundingClientRect.x===0&&s.boundingClientRect.y===0&&s.boundingClientRect.width===0&&s.boundingClientRect.height===0&&v.close()});n.observe(l),t(()=>n.disconnect())});function q(t){t.stopPropagation()}return()=>{let t={...e,ref:d,id:Y,role:"dialog","aria-modal":c.value===0?!0:void 0,"aria-labelledby":C.value,"aria-describedby":V.value,onClick:q},{open:l,initialFocus:n,...m}=o,s={open:c.value===0};return y(F,{force:!0},()=>y(H,()=>y(le,{target:d.value},()=>y(F,{force:!1},()=>O({props:{...m,...t},slot:s,attrs:e,slots:u,visible:c.value===0,features:L.RenderStrategy|L.Static,name:"Dialog"})))))}}}),$e=h({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"}},setup(o,{attrs:i,slots:e}){let u=P("DialogOverlay"),r=`headlessui-dialog-overlay-${b()}`;function p(a){a.target===a.currentTarget&&(a.preventDefault(),a.stopPropagation(),u.close())}return()=>O({props:{...o,...{id:r,"aria-hidden":!0,onClick:p}},slot:{open:u.dialogState.value===0},attrs:i,slots:e,name:"DialogOverlay"})}}),Be=h({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"}},inheritAttrs:!1,setup(o,{attrs:i,slots:e,expose:u}){let r=P("DialogBackdrop"),p=`headlessui-dialog-backdrop-${b()}`,a=D(null);return u({el:a,$el:a}),j(()=>{if(r.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let g=o,S={id:p,ref:a,"aria-hidden":!0};return y(F,{force:!0},()=>y(H,()=>O({props:{...i,...g,...S},slot:{open:r.dialogState.value===0},attrs:i,slots:e,name:"DialogBackdrop"})))}}}),je=h({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"}},setup(o,{attrs:i,slots:e,expose:u}){let r=P("DialogPanel"),p=`headlessui-dialog-panel-${b()}`;return u({el:r.panelRef,$el:r.panelRef}),()=>{let a={id:p,ref:r.panelRef};return O({props:{...o,...a},slot:{open:r.dialogState.value===0},attrs:i,slots:e,name:"DialogPanel"})}}}),Ae=h({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"}},setup(o,{attrs:i,slots:e}){let u=P("DialogTitle"),r=`headlessui-dialog-title-${b()}`;return j(()=>{u.setTitleId(r),Q(()=>u.setTitleId(null))}),()=>O({props:{...o,...{id:r}},slot:{open:u.dialogState.value===0},attrs:i,slots:e,name:"DialogTitle"})}}),Le=ne;export{Me as Dialog,Be as DialogBackdrop,Le as DialogDescription,$e as DialogOverlay,je as DialogPanel,Ae as DialogTitle};
